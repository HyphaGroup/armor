{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.threatmodel.civil/mitigations.schema.json",
  "title": "Mitigation Plans",
  "description": "Action plans for addressing identified risks",
  "type": "object",
  "required": ["mitigations"],
  "properties": {
    "mitigations": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["mitigation_id", "title", "risk_ids", "priority"],
        "properties": {
          "mitigation_id": {
            "type": "string",
            "description": "Unique identifier"
          },
          "title": {
            "type": "string",
            "description": "Short title for this mitigation"
          },
          "description": {
            "type": "string",
            "description": "What this mitigation involves"
          },
          "risk_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Which risks this addresses"
          },
          "mitigation_type": {
            "type": "string",
            "enum": [
              "technical_control",
              "policy_procedure",
              "training_awareness",
              "physical_control",
              "organizational_change",
              "third_party_service",
              "monitoring_detection",
              "response_capability",
              "other"
            ]
          },
          "priority": {
            "type": "string",
            "enum": ["critical", "high", "medium", "low"],
            "description": "Implementation priority"
          },
          "effort": {
            "type": "string",
            "enum": ["minimal", "low", "medium", "high", "major"],
            "description": "Implementation effort required"
          },
          "cost": {
            "type": "string",
            "enum": ["none", "low", "medium", "high"],
            "description": "Cost to implement"
          },
          "timeline": {
            "type": "object",
            "properties": {
              "target_start": { "type": "string", "format": "date" },
              "target_completion": { "type": "string", "format": "date" },
              "actual_start": { "type": "string", "format": "date" },
              "actual_completion": { "type": "string", "format": "date" }
            }
          },
          "owner": {
            "type": "string",
            "description": "Who is responsible"
          },
          "status": {
            "type": "string",
            "enum": ["planned", "in_progress", "completed", "blocked", "deferred", "cancelled"]
          },
          "actions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "action": { "type": "string" },
                "owner": { "type": "string" },
                "due_date": { "type": "string", "format": "date" },
                "status": {
                  "type": "string",
                  "enum": ["pending", "in_progress", "completed", "blocked"]
                },
                "notes": { "type": "string" }
              }
            },
            "description": "Specific action items"
          },
          "success_criteria": {
            "type": "string",
            "description": "How we know this is successfully implemented"
          },
          "residual_risk": {
            "type": "string",
            "description": "What risk remains after implementation"
          },
          "dependencies": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Other mitigations or prerequisites"
          },
          "blockers": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Current blockers if any"
          },
          "notes": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    },
    "action_plan_summary": {
      "type": "object",
      "properties": {
        "immediate_actions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Mitigation IDs for next 30 days"
        },
        "short_term_actions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Mitigation IDs for 30-90 days"
        },
        "long_term_actions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Mitigation IDs for 90+ days"
        },
        "total_estimated_cost": {
          "type": "string"
        },
        "resource_requirements": {
          "type": "string"
        },
        "quick_wins": {
          "type": "array",
          "items": { "type": "string" },
          "description": "High impact, low effort mitigations"
        }
      }
    },
    "progress_tracking": {
      "type": "object",
      "properties": {
        "last_review": {
          "type": "string",
          "format": "date"
        },
        "next_review": {
          "type": "string",
          "format": "date"
        },
        "completion_percentage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "status_summary": {
          "type": "object",
          "properties": {
            "planned": { "type": "integer" },
            "in_progress": { "type": "integer" },
            "completed": { "type": "integer" },
            "blocked": { "type": "integer" },
            "deferred": { "type": "integer" }
          }
        }
      }
    }
  }
}
