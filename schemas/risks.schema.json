{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.threatmodel.civil/risks.schema.json",
  "title": "Risk Register",
  "description": "Risk scenarios combining assets, threats, and vulnerabilities with three-factor scoring",
  "type": "object",
  "required": ["risks"],
  "properties": {
    "risks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["risk_id", "scenario", "asset_id", "threat_id", "asset_value_score", "likelihood_score", "vulnerability_score"],
        "properties": {
          "risk_id": {
            "type": "string",
            "description": "Unique identifier for this risk"
          },
          "scenario": {
            "type": "string",
            "description": "Risk scenario statement: 'There is a risk that [threat/adversary] could [action] affecting [asset], which would impact [mission area]'"
          },
          "asset_id": {
            "type": "string",
            "description": "Primary asset at risk"
          },
          "threat_id": {
            "type": "string",
            "description": "Primary threat"
          },
          "adversary_id": {
            "type": "string",
            "description": "Most likely adversary (if applicable)"
          },
          "vulnerability": {
            "type": "object",
            "properties": {
              "description": {
                "type": "string",
                "description": "What weakness could be exploited"
              },
              "existing_controls": {
                "type": "array",
                "items": { "type": "string" },
                "description": "What protections currently exist"
              },
              "control_gaps": {
                "type": "array",
                "items": { "type": "string" },
                "description": "What's missing or insufficient"
              }
            }
          },
          "asset_value_score": {
            "type": "integer",
            "minimum": 1,
            "maximum": 3,
            "description": "Asset value from asset identification: 1=Low, 2=Medium or High, 3=Critical"
          },
          "likelihood_score": {
            "type": "integer",
            "minimum": 1,
            "maximum": 3,
            "description": "Threat likelihood: 1=Unlikely, 2=Possible, 3=Expected/Active"
          },
          "likelihood_rationale": {
            "type": "string",
            "description": "Why this likelihood rating"
          },
          "vulnerability_score": {
            "type": "integer",
            "minimum": 1,
            "maximum": 3,
            "description": "Vulnerability/exposure: 1=Well-protected, 2=Some gaps, 3=Exposed"
          },
          "vulnerability_rationale": {
            "type": "string",
            "description": "Why this vulnerability rating"
          },
          "risk_score": {
            "type": "integer",
            "minimum": 1,
            "maximum": 27,
            "description": "Calculated: asset_value_score × likelihood_score × vulnerability_score"
          },
          "risk_level": {
            "type": "string",
            "enum": ["critical", "high", "moderate", "low"],
            "description": "Risk level: critical (18-27), high (10-17), moderate (4-9), low (1-3)"
          },
          "impact_areas": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "area": {
                  "type": "string",
                  "enum": [
                    "safety_security",
                    "mission_delivery",
                    "trust_reputation",
                    "financial_resources",
                    "legal_compliance",
                    "partner_relations"
                  ]
                },
                "impact_level": {
                  "type": "string",
                  "enum": ["high", "medium", "low", "none"]
                },
                "notes": { "type": "string" }
              }
            },
            "description": "Impact broken down by area (for context, not scoring)"
          },
          "primary_risk_driver": {
            "type": "string",
            "enum": ["asset_value", "likelihood", "vulnerability"],
            "description": "Which factor is driving this risk score highest"
          },
          "status": {
            "type": "string",
            "enum": ["identified", "accepted", "mitigating", "mitigated", "transferred"],
            "description": "Current risk status"
          },
          "mitigation_id": {
            "type": "string",
            "description": "Reference to mitigation plan if exists"
          },
          "notes": {
            "type": "string",
            "description": "Additional context"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    },
    "risk_summary": {
      "type": "object",
      "properties": {
        "total_risks": { "type": "integer" },
        "critical_risks": { "type": "integer" },
        "high_risks": { "type": "integer" },
        "moderate_risks": { "type": "integer" },
        "low_risks": { "type": "integer" },
        "top_risk_ids": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of highest priority risks"
        },
        "vulnerability_driven_risks": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Risk IDs where vulnerability is the primary driver (most actionable)"
        },
        "overall_risk_posture": {
          "type": "string",
          "description": "Narrative summary of risk posture"
        }
      }
    },
    "security_indicators": {
      "type": "object",
      "description": "Early warning indicators to monitor for threat environment changes",
      "properties": {
        "indicators": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "indicator_type": {
                "type": "string",
                "enum": [
                  "peer_incidents",
                  "sector_targeting",
                  "online_hostility",
                  "legal_regulatory",
                  "adversary_activity",
                  "staff_reports",
                  "technical_alerts",
                  "other"
                ]
              },
              "description": {
                "type": "string",
                "description": "What specifically to monitor"
              },
              "monitoring_owner": {
                "type": "string",
                "description": "Who is responsible for monitoring this"
              },
              "frequency": {
                "type": "string",
                "enum": ["daily", "weekly", "monthly", "ongoing", "triggered"]
              },
              "data_source": {
                "type": "string",
                "description": "Where to look for this indicator"
              }
            }
          }
        },
        "review_triggers": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "trigger": {
                "type": "string",
                "description": "What event or threshold triggers a review"
              },
              "action": {
                "type": "string",
                "enum": ["full_review", "targeted_review", "immediate_response", "monitor_closely"]
              }
            }
          },
          "description": "What indicator levels should trigger threat model review"
        },
        "last_indicator_review": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  }
}
